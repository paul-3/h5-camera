(this["webpackJsonph5-id-card"]=this["webpackJsonph5-id-card"]||[]).push([[0],{183:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n(9),i=n.n(o),c=n(75),r=n(12),s=n(56),d=n(39),u=n(79),l=n(40);function h(){l.a.hide()}function g(){h()}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";h(),l.a.loading(e,0,(function(){}))}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"fail":t,a=e.mask,o=void 0!==a&&a,i=e.duration,c=void 0===i?2:i,r=e.onClose,s=void 0===r?function(){}:r;l.a.fail(n,c,s,o)}var f=n(20),j=n.n(f),p=n(186),b=n(187);function O(e){function t(e,n,a){var o=new Image;o.src=e,o.onload=function(){var e=document.createElement("canvas"),o=this.width/n,i=this.height/n;e.setAttribute("width",o),e.setAttribute("height",i),e.getContext("2d").drawImage(this,0,0,o,i);var c=e.toDataURL("image/jpeg");e.toBlob((function(e){e.size>1000500?t(c,n,a):a(c)}),"image/jpeg")}}return new Promise((function(n){t(e,1.5,n)}))}function _(e){var t;return(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)?navigator.mediaDevices.getUserMedia(e):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e):navigator.mozGetUserMedia?navigator.mozGetUserMedia(e):navigator.getUserMedia?navigator.getUserMedia(e):void 0}function x(e,t){return new Promise((function(n,a){t.srcObject=e,t.onloadedmetadata=function(e){t.play(),n()}}))}var w=n(11),y=Object(r.g)((function(e){var t=e.history,n=Object(a.useState)(0),o=Object(u.a)(n,2),i=o[0],c=o[1],r=Object(a.useState)([]),s=Object(u.a)(r,2),h=s[0],f=s[1];Object(a.useRef)(null);Object(a.useEffect)((function(){var e,t=null,n=document.getElementById("video"),a=document.getElementById("cameraBtn"),o=(document.getElementById("changeBtn"),document.getElementById("capture-rectangle")),i=document.getElementById("container"),r=document.createElement("canvas");r.style.display="block",a.addEventListener("click",(function(e){!function(){var e=function(){var e=n.videoHeight,t=n.videoWidth,a=n.offsetHeight,o=n.offsetWidth;return{getHeight:function(t){return e/a*t},getWidth:function(e){return t/o*e}}}(),a=e.getHeight,c=e.getWidth,s=o.getBoundingClientRect(),d=s.left,u=s.top,l=s.width,h=s.height,g=r.getContext("2d");r.width=l,r.height=h,g.drawImage(n,c(d+window.scrollX),a(u+window.scrollY),c(l),a(h),0,0,l,h),t=r.toDataURL("image/jpeg"),console.log("base64Data",t);var v=document.createElement("img");v.setAttribute("id","canvasImg"),v.src=t;var m=document.getElementById("canvasImg");(function(e,t){var n;if(e&&t)for(n=e.parentNode;n;){if(t===n)return!0;n=n.parentNode}return!1})(m,i)&&i.removeChild(m);i.appendChild(v)}(),clearInterval()})),(e=n,_({audio:!1,video:{facingMode:{exact:"environment"}}}).then((function(t){return x(t,e)})).catch((function(e){return console.log("\u8bbf\u95ee\u7528\u6237\u5a92\u4f53\u8bbe\u5907\u5931\u8d25\uff1a",e.name,e.message),Promise.reject()}))).then((function(){c(n.offsetHeight)})).catch((function(e){m({text:"\u65e0\u6cd5\u8c03\u8d77\u540e\u7f6e\u6444\u50cf\u5934\uff0c\u8bf7\u70b9\u51fb\u76f8\u518c\uff0c\u624b\u52a8\u4e0a\u4f20\u8eab\u4efd\u8bc1",duration:6})}))}),[]);var y=function(e){v(),function(e){return new Promise((function(t){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){t(n.result)}}))}(e).then((function(t){return e.size>1000500?(v("\u56fe\u7247\u538b\u7f29\u4e2d..."),O(t)):t})).then((function(e){g(),function(e){var t=[];e&&(t=[{url:e}]),f(t)}(),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"Success":t,a=e.mask,o=void 0!==a&&a,i=e.duration,c=void 0===i?2:i,r=e.onClose,s=void 0===r?function(){}:r;l.a.success(n,c,s,o)}({text:"\u4e0a\u4f20\u6210\u529f!"})})).catch((function(e){console.error(e),g(),m({text:"\u4e0a\u4f20\u5931\u8d25"})}))},k={onChange:function(e){var t=e.target.files;(null===t||void 0===t?void 0:t[0])&&y(t[0])},accept:"image/jpeg,image/jpg,image/png",files:h},B=function(e){return Object(w.jsx)("input",Object(d.a)({className:j.a.input,type:"file"},e))};return Object(w.jsxs)("div",{id:"container",className:j.a.container,children:[Object(w.jsx)(p.a,{style:{fontSize:"0.555rem"},className:j.a.back,onClick:function(){t.goBack()}}),Object(w.jsx)("video",{id:"video",autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%"}}),Object(w.jsxs)("div",{className:j.a["shadow-layer"],style:{height:"".concat(i,"px")},children:[Object(w.jsx)("div",{id:"capture-rectangle",className:j.a["capture-rectangle"]}),Object(w.jsx)("div",{className:j.a["hold-tips"],children:"hold-tips"})]}),Object(w.jsx)("button",{id:"cameraBtn",className:j.a.cameraBtn,children:"\u62cd\u7167"}),Object(w.jsx)("button",{id:"changeBtn",className:j.a["change-camera"],children:"\u5207\u6362"}),Object(w.jsxs)("div",{className:j.a["gallery-container"],children:[Object(w.jsx)(B,Object(d.a)({},k)),Object(w.jsx)(b.a,{className:j.a.icon})]})]})})),k=function(){Object(s.b)((function(e){return e.hasToken}));return Object(w.jsx)(c.a,{children:Object(w.jsxs)(r.d,{children:[Object(w.jsx)(r.b,{path:"/photo",exact:!0,component:y}),Object(w.jsx)(r.a,{to:"/photo"})]})})},B=n(36),E="SET_HAS_TOKEN";var I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasToken:!1},t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.hasToken;return n===E?Object(d.a)(Object(d.a)({},e),{},{hasToken:a}):e},N=Object(B.combineReducers)({auth:I}),U=n(101),M=n(102),C=Object(B.createStore)(N,Object(U.composeWithDevTools)(Object(B.applyMiddleware)(M.a))),S=(n(180),n(181),n(182),function(){return Object(w.jsx)(s.a,{store:C,children:Object(w.jsx)(k,{})})});i.a.render(Object(w.jsx)(S,{}),document.getElementById("root"))},20:function(e,t,n){e.exports={container:"photo_container__rgeqZ",back:"photo_back__3PQ-b","shadow-layer":"photo_shadow-layer__NTgS5","capture-rectangle":"photo_capture-rectangle__IvEkK","hold-tips":"photo_hold-tips__3xMF8",tips:"photo_tips__Pn9KU",cameraBtn:"photo_cameraBtn__3SxX4","change-camera":"photo_change-camera__2qPwV","gallery-container":"photo_gallery-container__1AOx7",input:"photo_input__3gWy0",icon:"photo_icon__2cwh_"}}},[[183,1,2]]]);
//# sourceMappingURL=main.e07d3ddd.chunk.js.map