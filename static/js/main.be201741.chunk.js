(this["webpackJsonph5-id-card"]=this["webpackJsonph5-id-card"]||[]).push([[0],{183:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n(9),i=n.n(o),c=n(75),r=n(12),s=n(56),d=n(39),u=n(79),l=n(40);function h(){l.a.hide()}function g(){h()}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";h(),l.a.loading(e,0,(function(){}))}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"fail":t,a=e.mask,o=void 0!==a&&a,i=e.duration,c=void 0===i?2:i,r=e.onClose,s=void 0===r?function(){}:r;l.a.fail(n,c,s,o)}var m=n(22),j=n.n(m),p=n(186),b=n(187);function O(e){function t(e,n,a){var o=new Image;o.src=e,o.onload=function(){var e=document.createElement("canvas"),o=this.width/n,i=this.height/n;e.setAttribute("width",o),e.setAttribute("height",i),e.getContext("2d").drawImage(this,0,0,o,i);var c=e.toDataURL("image/jpeg");e.toBlob((function(e){e.size>1000500?t(c,n,a):a(c)}),"image/jpeg")}}return new Promise((function(n){t(e,1.5,n)}))}function _(e){return function(e){var t;return(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)?navigator.mediaDevices.getUserMedia(e):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e):navigator.mozGetUserMedia?navigator.mozGetUserMedia(e):navigator.getUserMedia?navigator.getUserMedia(e):void 0}({audio:!1,video:!0}).then((function(t){return n=t,a=e,new Promise((function(e,t){a.srcObject=n,a.onloadedmetadata=function(t){a.play(),e()}}));var n,a})).catch((function(e){return console.log("\u8bbf\u95ee\u7528\u6237\u5a92\u4f53\u8bbe\u5907\u5931\u8d25\uff1a",e.name,e.message),Promise.reject()}))}var x=n(11),w=Object(r.g)((function(e){var t=e.history,n=Object(a.useState)(0),o=Object(u.a)(n,2),i=o[0],c=o[1],r=Object(a.useState)([]),s=Object(u.a)(r,2),h=s[0],m=s[1];Object(a.useRef)(null);Object(a.useEffect)((function(){var e=null,t=document.getElementById("video"),n=document.getElementById("cameraBtn"),a=document.getElementById("capture-rectangle"),o=document.getElementById("container"),i=document.createElement("canvas");i.style.display="block",n.addEventListener("click",(function(n){!function(){var n=function(){var e=t.videoHeight,n=t.videoWidth,a=t.offsetHeight,o=t.offsetWidth;return{getHeight:function(t){return e/a*t},getWidth:function(e){return n/o*e}}}(),c=n.getHeight,r=n.getWidth,s=a.getBoundingClientRect(),d=s.left,u=s.top,l=s.width,h=s.height,g=i.getContext("2d");i.width=l,i.height=h,g.drawImage(t,r(d+window.scrollX),c(u+window.scrollY),r(l),c(h),0,0,l,h),e=i.toDataURL("image/jpeg"),console.log("base64Data",e);var v=document.createElement("img");v.setAttribute("id","canvasImg"),v.src=e;var f=document.getElementById("canvasImg");(function(e,t){var n;if(e&&t)for(n=e.parentNode;n;){if(t===n)return!0;n=n.parentNode}return!1})(f,o)&&o.removeChild(f);o.appendChild(v)}(),clearInterval()})),_(t).then((function(){c(t.offsetHeight)})).catch((function(e){f({text:"\u65e0\u6cd5\u8c03\u8d77\u540e\u7f6e\u6444\u50cf\u5934\uff0c\u8bf7\u70b9\u51fb\u76f8\u518c\uff0c\u624b\u52a8\u4e0a\u4f20\u8eab\u4efd\u8bc1",duration:6})}))}),[]);var w=function(e){v(),function(e){return new Promise((function(t){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){t(n.result)}}))}(e).then((function(t){return e.size>1000500?(v("\u56fe\u7247\u538b\u7f29\u4e2d..."),O(t)):t})).then((function(e){g(),function(e){var t=[];e&&(t=[{url:e}]),m(t)}(),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"Success":t,a=e.mask,o=void 0!==a&&a,i=e.duration,c=void 0===i?2:i,r=e.onClose,s=void 0===r?function(){}:r;l.a.success(n,c,s,o)}({text:"\u4e0a\u4f20\u6210\u529f!"})})).catch((function(e){console.error(e),g(),f({text:"\u4e0a\u4f20\u5931\u8d25"})}))},y={onChange:function(e){var t=e.target.files;(null===t||void 0===t?void 0:t[0])&&w(t[0])},accept:"image/jpeg,image/jpg,image/png",files:h},k=function(e){return Object(x.jsx)("input",Object(d.a)({className:j.a.input,type:"file"},e))};return Object(x.jsxs)("div",{id:"container",className:j.a.container,children:[Object(x.jsx)(p.a,{style:{fontSize:"0.555rem"},className:j.a.back,onClick:function(){t.goBack()}}),Object(x.jsx)("video",{id:"video",autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%"}}),Object(x.jsxs)("div",{className:j.a["shadow-layer"],style:{height:"".concat(i,"px")},children:[Object(x.jsx)("div",{id:"capture-rectangle",className:j.a["capture-rectangle"]}),Object(x.jsx)("div",{className:j.a["hold-tips"],children:"hold-tips"})]}),Object(x.jsx)("button",{id:"cameraBtn",className:j.a.cameraBtn,children:"\u62cd\u7167"}),Object(x.jsxs)("div",{className:j.a["gallery-container"],children:[Object(x.jsx)(k,Object(d.a)({},y)),Object(x.jsx)(b.a,{className:j.a.icon})]})]})})),y=function(){Object(s.b)((function(e){return e.hasToken}));return Object(x.jsx)(c.a,{children:Object(x.jsxs)(r.d,{children:[Object(x.jsx)(r.b,{path:"/photo",exact:!0,component:w}),Object(x.jsx)(r.a,{to:"/photo"})]})})},k=n(36),B="SET_HAS_TOKEN";var E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasToken:!1},t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.hasToken;return n===B?Object(d.a)(Object(d.a)({},e),{},{hasToken:a}):e},I=Object(k.combineReducers)({auth:E}),N=n(101),U=n(102),M=Object(k.createStore)(I,Object(N.composeWithDevTools)(Object(k.applyMiddleware)(U.a))),C=(n(180),n(181),n(182),function(){return Object(x.jsx)(s.a,{store:M,children:Object(x.jsx)(y,{})})});i.a.render(Object(x.jsx)(C,{}),document.getElementById("root"))},22:function(e,t,n){e.exports={container:"photo_container__rgeqZ",back:"photo_back__3PQ-b","shadow-layer":"photo_shadow-layer__NTgS5","capture-rectangle":"photo_capture-rectangle__IvEkK","hold-tips":"photo_hold-tips__3xMF8",tips:"photo_tips__Pn9KU",cameraBtn:"photo_cameraBtn__3SxX4","gallery-container":"photo_gallery-container__1AOx7",input:"photo_input__3gWy0",icon:"photo_icon__2cwh_"}}},[[183,1,2]]]);
//# sourceMappingURL=main.be201741.chunk.js.map