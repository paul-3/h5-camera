(this["webpackJsonph5-id-card"]=this["webpackJsonph5-id-card"]||[]).push([[0],{183:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n(9),o=n.n(a),c=n(75),r=n(12),s=n(56),d=n(39),u=n(79),l=n(40);function h(){l.a.hide()}function g(){h()}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";h(),l.a.loading(e,0,(function(){}))}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"fail":t,i=e.mask,a=void 0!==i&&i,o=e.duration,c=void 0===o?2:o,r=e.onClose,s=void 0===r?function(){}:r;l.a.fail(n,c,s,a)}var j=n(22),p=n.n(j),b=n(186),m=n(187);function O(e){function t(e,n,i){var a=new Image;a.src=e,a.onload=function(){var e=document.createElement("canvas"),a=this.width/n,o=this.height/n;e.setAttribute("width",a),e.setAttribute("height",o),e.getContext("2d").drawImage(this,0,0,a,o);var c=e.toDataURL("image/jpeg");e.toBlob((function(e){e.size>1000500?t(c,n,i):i(c)}),"image/jpeg")}}return new Promise((function(n){t(e,1.5,n)}))}function x(e){return function(e){var t;return(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)?navigator.mediaDevices.getUserMedia(e):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e):navigator.mozGetUserMedia?navigator.mozGetUserMedia(e):navigator.getUserMedia?navigator.getUserMedia(e):void 0}({audio:!1,video:{facingMode:{exact:"environment"}}}).then((function(t){return n=t,i=e,new Promise((function(e,t){i.srcObject=n,i.onloadedmetadata=function(t){i.play(),e()}}));var n,i})).catch((function(e){return console.log("\u8bbf\u95ee\u7528\u6237\u5a92\u4f53\u8bbe\u5907\u5931\u8d25\uff1a",e.name,e.message),Promise.reject()}))}var _=n(11),w=Object(r.g)((function(e){var t=e.history,n=Object(i.useState)(0),a=Object(u.a)(n,2),o=a[0],c=a[1],r=Object(i.useState)([]),s=Object(u.a)(r,2),h=s[0],j=s[1],w=Object(i.useRef)(null);Object(i.useEffect)((function(){var e=document.getElementById("video"),t=document.getElementById("capture-rectangle"),n=(document.getElementById("container"),document.createElement("canvas"));return n.style.display="block",x(e).then((function(){c(e.offsetHeight),w.current=setInterval((function(){var i=function(){var t=e.videoHeight,n=e.videoWidth,i=e.offsetHeight,a=e.offsetWidth;return{getHeight:function(e){return t/i*e},getWidth:function(e){return n/a*e}}}(),a=i.getHeight,o=i.getWidth,c=t.getBoundingClientRect(),r=c.left,s=c.top,d=c.width,u=c.height,l=n.getContext("2d");n.width=d,n.height=u,l.drawImage(e,o(r+window.scrollX),a(s+window.scrollY),o(d),a(u),0,0,d,u),n.toDataURL("image/jpeg")}),200)})).catch((function(e){f({text:"\u65e0\u6cd5\u8c03\u8d77\u540e\u7f6e\u6444\u50cf\u5934\uff0c\u8bf7\u70b9\u51fb\u76f8\u518c\uff0c\u624b\u52a8\u4e0a\u4f20\u8eab\u4efd\u8bc1",duration:6})})),function(){return clearInterval(w.current)}}),[]);var y=function(e){v(),function(e){return new Promise((function(t){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){t(n.result)}}))}(e).then((function(t){return e.size>1000500?(v("\u56fe\u7247\u538b\u7f29\u4e2d..."),O(t)):t})).then((function(e){g(),function(e){var t=[];e&&(t=[{url:e}]),j(t)}(),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"Success":t,i=e.mask,a=void 0!==i&&i,o=e.duration,c=void 0===o?2:o,r=e.onClose,s=void 0===r?function(){}:r;l.a.success(n,c,s,a)}({text:"\u4e0a\u4f20\u6210\u529f!"})})).catch((function(e){console.error(e),g(),f({text:"\u4e0a\u4f20\u5931\u8d25"})}))},k={onChange:function(e){var t=e.target.files;(null===t||void 0===t?void 0:t[0])&&y(t[0])},accept:"image/jpeg,image/jpg,image/png",files:h},U=function(e){return Object(_.jsx)("input",Object(d.a)({className:p.a.input,type:"file"},e))};return Object(_.jsxs)("div",{id:"container",className:p.a.container,children:[Object(_.jsx)(b.a,{style:{fontSize:"0.555rem"},className:p.a.back,onClick:function(){t.goBack()}}),Object(_.jsx)("video",{id:"video",autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%"}}),Object(_.jsxs)("div",{className:p.a["shadow-layer"],style:{height:"".concat(o,"px")},children:[Object(_.jsx)("div",{id:"capture-rectangle",className:p.a["capture-rectangle"]}),Object(_.jsx)("div",{className:p.a["hold-tips"],children:"hold-tips"})]}),Object(_.jsx)("div",{className:p.a.tips,children:"tips"}),Object(_.jsxs)("div",{className:p.a["gallery-container"],children:[Object(_.jsx)(U,Object(d.a)({},k)),Object(_.jsx)(m.a,{className:p.a.icon})]})]})})),y=function(){Object(s.b)((function(e){return e.hasToken}));return Object(_.jsx)(c.a,{children:Object(_.jsxs)(r.d,{children:[Object(_.jsx)(r.b,{path:"/photo",exact:!0,component:w}),Object(_.jsx)(r.a,{to:"/photo"})]})})},k=n(36),U="SET_HAS_TOKEN";var I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasToken:!1},t=arguments.length>1?arguments[1]:void 0,n=t.type,i=t.hasToken;return n===U?Object(d.a)(Object(d.a)({},e),{},{hasToken:i}):e},M=Object(k.combineReducers)({auth:I}),N=n(101),E=n(102),S=Object(k.createStore)(M,Object(N.composeWithDevTools)(Object(k.applyMiddleware)(E.a))),T=(n(180),n(181),n(182),function(){return Object(_.jsx)(s.a,{store:S,children:Object(_.jsx)(y,{})})});o.a.render(Object(_.jsx)(T,{}),document.getElementById("root"))},22:function(e,t,n){e.exports={container:"photo_container__rgeqZ",back:"photo_back__3PQ-b","shadow-layer":"photo_shadow-layer__NTgS5","capture-rectangle":"photo_capture-rectangle__IvEkK","hold-tips":"photo_hold-tips__3xMF8",tips:"photo_tips__Pn9KU","gallery-container":"photo_gallery-container__1AOx7",input:"photo_input__3gWy0",icon:"photo_icon__2cwh_"}}},[[183,1,2]]]);
//# sourceMappingURL=main.631f2280.chunk.js.map