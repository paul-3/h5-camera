(this["webpackJsonph5-id-card"]=this["webpackJsonph5-id-card"]||[]).push([[0],{182:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n(9),o=n.n(a),c=n(74),r=n(11),s=n(56),d=n(39),u=n(78),l=n(40);function h(){l.a.hide()}function g(){h()}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";h(),l.a.loading(e,0,(function(){}))}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"fail":t,i=e.mask,a=void 0!==i&&i,o=e.duration,c=void 0===o?2:o,r=e.onClose,s=void 0===r?function(){}:r;l.a.fail(n,c,s,a)}var j=n(22),p=n.n(j),b=n(185);function m(e){function t(e,n,i){var a=new Image;a.src=e,a.onload=function(){var e=document.createElement("canvas"),a=this.width/n,o=this.height/n;e.setAttribute("width",a),e.setAttribute("height",o),e.getContext("2d").drawImage(this,0,0,a,o);var c=e.toDataURL("image/jpeg");e.toBlob((function(e){e.size>1000500?t(c,n,i):i(c)}),"image/jpeg")}}return new Promise((function(n){t(e,1.5,n)}))}function O(e){return function(e){var t;return(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)?navigator.mediaDevices.getUserMedia(e):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e):navigator.mozGetUserMedia?navigator.mozGetUserMedia(e):navigator.getUserMedia?navigator.getUserMedia(e):void 0}({audio:!1,video:!0}).then((function(t){return n=t,i=e,new Promise((function(e,t){i.srcObject=n,i.onloadedmetadata=function(t){i.play(),e()}}));var n,i})).catch((function(e){return console.log("\u8bbf\u95ee\u7528\u6237\u5a92\u4f53\u8bbe\u5907\u5931\u8d25\uff1a",e.name,e.message),Promise.reject()}))}var _=n(12),x=Object(r.g)((function(e){e.history;var t=Object(i.useState)(0),n=Object(u.a)(t,2),a=n[0],o=n[1],c=Object(i.useState)([]),r=Object(u.a)(c,2),s=r[0],h=r[1],j=Object(i.useRef)(null);Object(i.useEffect)((function(){var e=document.getElementById("video"),t=document.getElementById("capture-rectangle"),n=(document.getElementById("container"),document.createElement("canvas"));return n.style.display="block",O(e).then((function(){o(e.offsetHeight),j.current=setInterval((function(){var i=function(){var t=e.videoHeight,n=e.videoWidth,i=e.offsetHeight,a=e.offsetWidth;return{getHeight:function(e){return t/i*e},getWidth:function(e){return n/a*e}}}(),a=i.getHeight,o=i.getWidth,c=t.getBoundingClientRect(),r=c.left,s=c.top,d=c.width,u=c.height,l=n.getContext("2d");n.width=d,n.height=u,l.drawImage(e,o(r+window.scrollX),a(s+window.scrollY),o(d),a(u),0,0,d,u),n.toDataURL("image/jpeg")}),200)})).catch((function(e){f({text:"\u65e0\u6cd5\u8c03\u8d77\u540e\u7f6e\u6444\u50cf\u5934\uff0c\u8bf7\u70b9\u51fb\u76f8\u518c\uff0c\u624b\u52a8\u4e0a\u4f20\u8eab\u4efd\u8bc1",duration:6})})),function(){return clearInterval(j.current)}}),[]);var x=function(e){v(),function(e){return new Promise((function(t){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){t(n.result)}}))}(e).then((function(t){return e.size>1000500?(v("\u56fe\u7247\u538b\u7f29\u4e2d..."),m(t)):t})).then((function(e){g(),function(e){var t=[];e&&(t=[{url:e}]),h(t)}(),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?"Success":t,i=e.mask,a=void 0!==i&&i,o=e.duration,c=void 0===o?2:o,r=e.onClose,s=void 0===r?function(){}:r;l.a.success(n,c,s,a)}({text:"\u4e0a\u4f20\u6210\u529f!"})})).catch((function(e){console.error(e),g(),f({text:"\u4e0a\u4f20\u5931\u8d25"})}))},w={onChange:function(e){var t=e.target.files;(null===t||void 0===t?void 0:t[0])&&x(t[0])},accept:"image/jpeg,image/jpg,image/png",files:s},y=function(e){return Object(_.jsx)("input",Object(d.a)({className:p.a.input,type:"file"},e))};return Object(_.jsxs)("div",{id:"container",className:p.a.container,children:[Object(_.jsx)("video",{id:"video",autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%"}}),Object(_.jsxs)("div",{className:p.a["shadow-layer"],style:{height:"".concat(a,"px")},children:[Object(_.jsx)("div",{id:"capture-rectangle",className:p.a["capture-rectangle"]}),Object(_.jsx)("div",{className:p.a["hold-tips"],children:"hold-tips"})]}),Object(_.jsx)("div",{className:p.a.tips,children:"tips"}),Object(_.jsxs)("div",{className:p.a["gallery-container"],children:[Object(_.jsx)(y,Object(d.a)({},w)),Object(_.jsx)(b.a,{className:p.a.icon})]})]})})),w=function(){Object(s.b)((function(e){return e.hasToken}));return Object(_.jsx)(c.a,{children:Object(_.jsxs)(r.d,{children:[Object(_.jsx)(r.b,{path:"/photo",exact:!0,component:x}),Object(_.jsx)(r.a,{to:"/photo"})]})})},y=n(36),k="SET_HAS_TOKEN";var U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasToken:!1},t=arguments.length>1?arguments[1]:void 0,n=t.type,i=t.hasToken;return n===k?Object(d.a)(Object(d.a)({},e),{},{hasToken:i}):e},I=Object(y.combineReducers)({auth:U}),E=n(100),M=n(101),N=Object(y.createStore)(I,Object(E.composeWithDevTools)(Object(y.applyMiddleware)(M.a))),T=(n(179),n(180),n(181),function(){return Object(_.jsx)(s.a,{store:N,children:Object(_.jsx)(w,{})})});o.a.render(Object(_.jsx)(T,{}),document.getElementById("root"))},22:function(e,t,n){e.exports={container:"photo_container__rgeqZ",back:"photo_back__3PQ-b","shadow-layer":"photo_shadow-layer__NTgS5","capture-rectangle":"photo_capture-rectangle__IvEkK","hold-tips":"photo_hold-tips__3xMF8",tips:"photo_tips__Pn9KU","gallery-container":"photo_gallery-container__1AOx7",input:"photo_input__3gWy0",icon:"photo_icon__2cwh_"}}},[[182,1,2]]]);
//# sourceMappingURL=main.fa9965ba.chunk.js.map